{% extends "base.html" %}
{% load staticfiles %}


{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'dcjs/dc.css' %}"/>

<style type="text/css">

#chart-ring-year {
  margin-top: 15px;
}

#chart-hist-spend {
  margin-top: 15px;
}

</style>

{% endblock %}

{% block content %}

       
        <nav class="top-bar" data-topbar>
          <ul class="title-area">
             
            <li class="name">
              <h1>
                <a href="#">
                  <img src="{% static 'research-32.png' %}"/>
                  Research.net
                </a>
              </h1>
            </li>
            
          </ul>
       
          <section class="top-bar-section">
             
            <ul class="right">
              <li class="divider"></li>
              
              <li class="divider"></li>

              <li class="divider"></li>
               <li class="has-dropdown">
                <a href="#">My Account</a>
                <ul class="dropdown">
                  <li><a href="{% url 'django.contrib.auth.views.logout' %}">Logout</a></li>
                </ul>
              </li>

            </ul>
          </section>
        </nav>
       

            <div class="row">

              <div class="large-6 columns">
                <div id="chart-hist-spend"></div>
              </div>
              <div class="large-6 columns">
                <div id="chart-ring-year"></div>
              </div>
            </div>

       
            <div class="row">
              <div class="large-12 columns show-for-small">
       
                <img src="http://placehold.it/1200x700&text=Mobile Header">
       
              </div>
            </div>
            <br>

            <div class="row">
  <table width="100%">
  <thead>
    <tr>
      <th width="200">Date</th>
      <th>Device ID</th>
      <th width="350">Username</th>
      <th>Location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10/2/2015</td>
      <td>1231234132</td>
      <td>alfazo</td>
      <td>Scottsdale, AZ</td>
    </tr>
    <tr>
      <td>9/29/2015</td>
      <td>3423426324</td>
      <td>bieberhold</td>
      <td>St. Paul, MN</td>
    </tr>
    <tr>
      <td>9/29/2015</td>
      <td>23423456435</td>
      <td>little_pope</td>
      <td>Durham, NC</td>
    </tr>
  </tbody>
</table>
            </div>
       
           

{% endblock %}

{% block javascript %}

  <script src="{% static 'd3/d3.min.js' %}"></script>
  <script src="{% static 'crossfilter/crossfilter.js' %}"></script>
  <script src="{% static 'dcjs/dc.js' %}"></script>

  <script type="text/javascript">

var yearRingChart   = dc.pieChart("#chart-ring-year"),
    spendHistChart  = dc.barChart("#chart-hist-spend"),
    spenderRowChart = dc.rowChart("#chart-row-spenders");

// use static or load via d3.csv("spendData.csv", function(error, spendData) {/* do stuff */});
var spendData = [
    {Name: 'Mr A', Spent: '$40', Year: 2011},
    {Name: 'Mr B', Spent: '$10', Year: 2011},
    {Name: 'Mr C', Spent: '$40', Year: 2011},
    {Name: 'Mr A', Spent: '$70', Year: 2012},
    {Name: 'Mr B', Spent: '$20', Year: 2012},
    {Name: 'Mr B', Spent: '$50', Year: 2013},
    {Name: 'Mr C', Spent: '$30', Year: 2013}
];

// normalize/parse data
spendData.forEach(function(d) {
    d.Spent = d.Spent.match(/\d+/);
});

// set crossfilter
var ndx = crossfilter(spendData),
    yearDim  = ndx.dimension(function(d) {return +d.Year;}),
    spendDim = ndx.dimension(function(d) {return Math.floor(d.Spent/10);}),
    nameDim  = ndx.dimension(function(d) {return d.Name;}),
    spendPerYear = yearDim.group().reduceSum(function(d) {return +d.Spent;}),
    spendPerName = nameDim.group().reduceSum(function(d) {return +d.Spent;}),
    spendHist    = spendDim.group().reduceCount();

yearRingChart
    .width(300).height(300)
    .dimension(yearDim)
    .group(spendPerYear)
    .innerRadius(50);

spendHistChart
    .width(500).height(300)
    .dimension(spendDim)
    .group(spendHist)
    .x(d3.scale.linear().domain([0,10]))
    .elasticY(true);

spendHistChart.xAxis().tickFormat(function(d) {return d*10}); // convert back to base unit
spendHistChart.yAxis().ticks(2);

spenderRowChart
    .width(350).height(200)
    .dimension(nameDim)
    .group(spendPerName)
    .elasticX(true);

dc.renderAll();

</script>


{% endblock %}
